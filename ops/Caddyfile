{
  # canary: webhook-driven deploy
  email {$TLS_CONTACT_EMAIL}
}

(chainmmo_security) {
  encode zstd gzip
  header {
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    Referrer-Policy "no-referrer"
  }
}

# Testnet origins: only testnet backend data.
test.chainmmo.com, api.test.chainmmo.com {
  import chainmmo_security
  @coolify_github_webhook {
    path /webhooks/source/github/events/manual /webhooks/source/github/events
  }
  handle @coolify_github_webhook {
    reverse_proxy coolify:8080
  }
  reverse_proxy mid-testnet:8787
}

# Main origin: mainnet backend.
chainmmo.com, api.chainmmo.com {
  import chainmmo_security
  @coolify_github_webhook {
    path /webhooks/source/github/events/manual /webhooks/source/github/events
  }
  handle @coolify_github_webhook {
    reverse_proxy coolify:8080
  }
  reverse_proxy mid-mainnet:8787
}

www.chainmmo.com {
  import chainmmo_security
  redir https://chainmmo.com{uri} 301
}
