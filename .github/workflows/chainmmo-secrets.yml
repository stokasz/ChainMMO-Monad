name: ChainMMO Secret Scan

permissions: {}

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  secret-scan:
    name: Secret scan (gitleaks)
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v5
        with:
          persist-credentials: false
          # Avoid scanning vendored submodules in CI; we only care about this repo.
          submodules: false
          fetch-depth: 1

      - name: Install gitleaks
        run: |
          set -euo pipefail
          VERSION="8.30.0"
          curl -fsSL "https://github.com/gitleaks/gitleaks/releases/download/v${VERSION}/gitleaks_${VERSION}_linux_x64.tar.gz" -o /tmp/gitleaks.tar.gz
          tar -xzf /tmp/gitleaks.tar.gz -C /tmp
          sudo mv /tmp/gitleaks /usr/local/bin/gitleaks
          gitleaks version

      - name: Scan (redacted)
        run: |
          set -euo pipefail
          gitleaks detect --source . --no-git --redact --exit-code 1 --config .gitleaks.toml
